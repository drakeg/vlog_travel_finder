{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
  <div class="mb-4">
    <div class="card shadow-sm hero-card" data-aos="fade-up">
      <div class="card-body p-4 p-lg-5">
        <div class="row g-4 align-items-center">
          <div class="col-12 {% if hero_image_url or featured_youtube_url %}col-lg-7{% endif %}">
            <h1 class="display-6 fw-bold mb-2">{{ site_name }}</h1>
            <div class="lead hero-lead mb-3">
              Travel inspiration, place guides, and behind-the-scenes from our trips.
            </div>
            <div class="d-flex flex-column flex-sm-row gap-2">
              <a class="btn btn-primary" href="{{ url_for('public.places') }}">
                <i class="fa-solid fa-map-location-dot me-1"></i>Browse places
              </a>
              <a class="btn btn-outline-secondary" href="{{ url_for('public.blog_index') }}">
                <i class="fa-solid fa-newspaper me-1"></i>Read the blog
              </a>
              <a class="btn btn-outline-secondary" href="{{ url_for('public.contact') }}">
                <i class="fa-solid fa-envelope me-1"></i>Contact
              </a>
            </div>
          </div>
          {% if hero_image_url %}
            <div class="col-12 col-lg-5">
              <div class="hero-image-wrap rounded overflow-hidden">
                <img class="hero-image" src="{{ hero_image_url }}" alt="{{ hero_image_alt or (site_name ~ ' hero image') }}" loading="lazy" />
              </div>
            </div>
          {% endif %}
          {% if featured_youtube_url %}
            <div class="col-12 col-lg-5">
              <div class="d-flex align-items-center justify-content-between gap-2 mb-2">
                <h2 class="h6 mb-0">Featured video</h2>
              </div>
              <div class="ratio ratio-16x9 rounded overflow-hidden bg-body-secondary" id="featuredVideo" data-embed-url="{{ featured_youtube_url }}">
                {% if featured_thumbnail_url %}
                  <img src="{{ featured_thumbnail_url }}" alt="Featured video" class="w-100 h-100 object-fit-cover" loading="lazy" />
                {% else %}
                  <div class="w-100 h-100 d-flex align-items-center justify-content-center text-muted">Featured video</div>
                {% endif %}
                <button type="button" class="btn btn-dark position-absolute top-50 start-50 translate-middle" style="z-index: 3;" onclick="vlogLoadEmbed('featuredVideo')">
                  <i class="fa-solid fa-play me-1"></i>Play here
                </button>
              </div>
              {% if featured_video_url %}
                <div class="mt-2">
                  <a class="btn btn-sm btn-outline-secondary" href="{{ featured_video_url }}" target="_blank" rel="noopener noreferrer">
                    Watch on YouTube
                    <i class="fa-solid fa-arrow-right ms-1"></i>
                  </a>
                </div>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-12 {% if latest_video %}col-lg-8{% endif %}">
      <div class="card shadow-sm" data-aos="fade-up" data-aos-delay="50">
        <div class="card-body p-4">
          <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2 mb-2">
            <h2 class="h5 mb-0">Latest posts</h2>
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('public.blog_index') }}">
              View all
              <i class="fa-solid fa-arrow-right ms-1"></i>
            </a>
          </div>

          {% if posts %}
            <div class="list-group list-group-flush">
              {% for p in posts %}
                <a class="list-group-item list-group-item-action" href="{{ url_for('public.blog_post', slug=p.slug) }}">
                  <div class="fw-semibold">{{ p.title }}</div>
                  <div class="text-muted small">Read more</div>
                </a>
              {% endfor %}
            </div>
          {% else %}
            <div class="text-muted">No posts yet.</div>
          {% endif %}
        </div>
      </div>
    </div>

    {% if latest_video or youtube_channel_url %}
      <div class="col-12 col-lg-4">
        <div class="card shadow-sm" data-aos="fade-up" data-aos-delay="75">
          <div class="card-body p-4">
            <div class="d-flex align-items-center justify-content-between gap-2 mb-2">
              <h2 class="h6 mb-0">Latest video</h2>
              {% if latest_video %}
                <a class="btn btn-sm btn-outline-secondary" href="{{ latest_video.url }}" target="_blank" rel="noopener noreferrer">
                  YouTube
                  <i class="fa-solid fa-arrow-right ms-1"></i>
                </a>
              {% elif youtube_channel_url %}
                <a class="btn btn-sm btn-outline-secondary" href="{{ youtube_channel_url }}" target="_blank" rel="noopener noreferrer">
                  Channel
                  <i class="fa-solid fa-arrow-right ms-1"></i>
                </a>
              {% endif %}
            </div>

            {% if latest_video %}
              <div class="ratio ratio-16x9 rounded overflow-hidden mb-2 bg-body-secondary" id="latestVideo" data-embed-url="{{ latest_video.embed_url }}">
                <img src="{{ latest_video.thumbnail_url }}" alt="{{ latest_video.title }}" class="w-100 h-100 object-fit-cover" loading="lazy" />
                <button type="button" class="btn btn-dark position-absolute top-50 start-50 translate-middle" style="z-index: 3;" onclick="vlogLoadEmbed('latestVideo')">
                  <i class="fa-solid fa-play me-1"></i>Play here
                </button>
              </div>

              <div class="fw-semibold">{{ latest_video.title }}</div>
              <div class="text-muted small">Watch right here, or open in YouTube.</div>
            {% else %}
              <div class="text-muted">Latest video unavailable right now.</div>
              <div class="text-muted small mt-1">If your host blocks outbound requests to YouTube, we canâ€™t fetch the RSS feed. You can still visit the channel.</div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endif %}
  </div>

  <script>
    function vlogLoadEmbed(containerId) {
      var el = document.getElementById(containerId);
      if (!el) return;
      var src = el.getAttribute('data-embed-url');
      if (!src) return;
      if (src.indexOf('autoplay=1') === -1) {
        src = src + (src.indexOf('?') === -1 ? '?' : '&') + 'autoplay=1';
      }
      el.innerHTML =
        '<iframe src="' +
        src +
        '" title="Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>';
    }
  </script>
{% endblock %}
